<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tooltip y Popover | A11Y</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../style.css">
</head>

<body class="min-vh-100 vstack">
    <a href="#main"
        class="btn btn-primary fixed-top top-0 start-50 translate-middle-x mt-4 visually-hidden-focusable">Saltar
        al contenido principal</a>
    <div id="header" class="sticky-top"></div>
    <main id="main" class="py-5 text-bg-light">
        <div class="container">
            <div class="row row-cols-1 row-cols-xl-2 g-5">
                <div class="col col-xl-9 vstack gap-3">
                    <h1 class="display-5 border-bottom pb-3">Ejemplo de rótulos y cuadros emergentes</h1>
                    <p>Unos de los elementos más socorridos para proporcionar información adicional, mejorando la
                        usabilidad y la eficiencia sin saturar la interfaz, son los <strong>rótulos (tooltips)</strong>
                        y los <strong>cuadros emergentes (popovers)</strong>. Los primeros son mensajes breves que
                        aparecen al pasar el cursor o al enfocarse un elemento. Útiles para aclaraciones rápidas,
                        siglas, atajos de teclado o detalles contextuales. Los segundos son cuadros más grandes que
                        pueden contener títulos, varias líneas de texto, listas, u otros contenidos. Son útiles para
                        instrucciones detalladas, información contextual más rica o acciones relacionadas (p. ej.,
                        elegir opciones, ver detalles de un ítem).</p>

                    <h2 class="border-bottom pb-3"><i class="bi bi-universal-access-circle"></i> Problemas de
                        accesibilidad más frecuentes</h2>
                    <dl>
                        <dt>Acceso solo por ratón (mouse)</dt>
                        <dd>Muchos tooltips solo se muestran con hover. Usuarios de teclado no pueden activarlos si no
                            están diseñados para foco.</dd>
                        <dt>Anunciación por tecnologías de asistencia insuficiente</dt>
                        <dd>Falta de roles, atributos aria adecuados, o textos no legibles por lectores de pantalla.
                        </dd>
                        <dt>Problemas de temporización</dt>
                        <dd>Tooltips que permanecen demasiado breve o se muestran/ocultan sin control predictible,
                            dificultando su lectura por usuarios de lectura en pantalla.</dd>
                        <dt>Cierre inaccesible</dt>
                        <dd>No hay forma clara de cerrar el popover (teclas, clic fuera, o escape) para usuarios que no
                            usan ratón.</dd>
                        <dt>Lectura dependiente del contenido</dt>
                        <dd>Contenido del tooltip que no es relevante para todos los usuarios</dd>
                    </dl>

                    <h2 class="border-bottom pb-3"><i class="bi bi-ui-checks"></i> Mejores prácticas para mejorar la
                        accesibilidad</h2>
                    <h3 class="h4 fw-bold">Soporte de teclado</h3>
                    <ul>
                        <li>Activa el <strong>tooltip</strong> con <code>:focus</code> (tecla <kbd>Tab</kbd>), no solo
                            con <code>:hover</code>, y con teclado usa <kbd>Esc</kbd> para cerrarlo.
                        </li>
                        <li>En el caso del <strong>popover</strong> evita que la apertura se base únicamente en
                            <code>:hover</code> o <code>:focus</code>, asegúrate de que el control que lo abre reciba
                            foco y se active haciendo 'click' o con teclado (Enter/Space para activar, Esc para cerrar).
                        </li>
                    </ul>
                    <h3 class="h4 fw-bold">Roles y atributos ARIA adecuados</h3>
                    <ul>
                        <li>
                            <strong>Tooltip:</strong>
                            <ul>
                                <li>Usa <code>role="tooltip"</code> en el contenedor.</li>
                                <li>Oculta el tooltip a lectores de pantalla usando <code>aria-hidden="true"</code>.
                                </li>
                                <li>Incluye en el disparador el texto accesible equivalente (<code>aria-label</code> o
                                    <code>aria-description</code>) si no lo tiene ya como texto real o como texto
                                    alternativo si se trata de una imagen.
                                </li>
                                <li>Asegurar que cierra con <kbd>Esc</kbd>.</li>
                            </ul>
                        </li>
                        <li>
                            <strong>Popover:</strong>
                            <ul>
                                <li>Si es contenido informativo sin interacción usar <code>role="status"</code> en el
                                    contenedor para que el lector de pantalla lo detecte al abrirse.</li>
                                <li>Oculta el popover a lectores de pantalla usando <code>aria-hidden="true"</code> ya
                                    que solo queremos quese lea una vez, con la interacción.
                                </li>
                                <li>El disparador es un conmutador lo que implica incluir la propiedad
                                    <code>aria-pressed</code> y controlar su valor dinámicamente.
                                </li>
                                <li>Asegurar que cierra con <kbd>Esc</kbd>.</li>
                            </ul>
                        </li>
                    </ul>

                    <h2 class="border-bottom pb-3"><i class="bi bi-grid-1x2-fill"></i> Ejemplos de uso</h2>
                    <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                        <div class="col">
                            <div class="card h-100">
                                <div class="card-header text-body-secondary">
                                    <h2 class="card-title h5 mb-0">Tooltip</h2>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">Un <strong>rótulo (tooltip)</strong> es una ventana que muestra
                                        información relacionada con un elemento cuando este recibe el foco del teclado o
                                        el ratón se sitúa sobre él. Normalmente aparece después de un pequeño retardo y
                                        desaparece al pulsar la tecla <kbd>Escape</kbd> o al retirar el ratón. Es
                                        exclusivamente visual, la información equivalente para el lector de pantalla
                                        consta en el texto accesible (<code>aria-label</code> o
                                        <code>aria-description</code>) del elemento activador.
                                    </p>
                                </div>
                                <div class="card-footer text-body-secondary p-3">
                                    <div class="bg-white border border-2 rounded-2">
                                        <nav class="navbar bg-body-tertiary rounded-top-2">
                                            <div class="container-fluid px-3">
                                                <a class="navbar-brand" href="#">Logotipo</a>
                                                <button type="button"
                                                    class="btn btn-light lh-1 p-3 my-n2 me-n3 rounded-top-2 rounded-start-0 rounded-bottom-0 border-0 position-relative"
                                                    title="Notificaciones"><i class="bi bi-bell-fill fs-4" role="img"
                                                        aria-label="Notificaciones"></i>
                                                    <span
                                                        class="position-absolute top-0 end-0 m-1 badge rounded-pill bg-danger">
                                                        3 <span class="visually-hidden">sin leer</span>
                                                    </span>
                                                </button>
                                            </div>
                                        </nav>
                                        <div class="container-fluid py-2">
                                            <p>Lorem ipsum dolor sit, amet consectetur adipisicing elit. Temporibus
                                                expedita sint unde non rerum. Voluptas iusto vero similique beatae
                                                dolores necessitatibus cupiditate, temporibus dolorum iste labore!
                                                Veniam inventore earum quibusdam.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col">
                            <div class="card h-100">
                                <div class="card-header text-body-secondary">
                                    <h2 class="card-title h5 mb-0">Popover</h2>
                                </div>
                                <div class="card-body">
                                    <p class="card-text">En cambio, un <strong>cuadro de información emergente
                                            (popover)</strong> es una ventana que muestra información adicional sobre
                                        cualquier aspecto del contenido cercano al elemento que lo activa. Al activar
                                        dicho elemento aparecerá la información y permanecerá visible hasta activarlo de
                                        nuevo, activar otro elemento, hacer 'click' fuera o al pulsar la tecla
                                        <kbd>Escape</kbd>.
                                    </p>
                                </div>
                                <div class="card-footer text-body-secondary p-3">
                                    <form>
                                        <div class="mb-3">
                                            <label for="exampleInputEmail1" class="form-label">Correo
                                                electrónico</label>
                                            <input type="email" class="form-control" id="exampleInputEmail1"
                                                aria-describedby="emailHelp">
                                            <div id="emailHelp" class="form-text">Nunca compartiremos tu email con
                                                nadie.</div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="exampleInputSubject1" class="form-label">Asunto</label>
                                            <input type="text" class="form-control" id="exampleInputSubject1">
                                        </div>
                                        <div class="mb-3">
                                            <label for="exampleTextareaMessage1" class="form-label">Mensaje</label>
                                            <textarea class="form-control" id="exampleTextareaMessage1"></textarea>
                                        </div>
                                        <div class="mb-3 form-check">
                                            <div class="hstack gap-2">
                                                <input type="checkbox" class="form-check-input" id="exampleCheck">
                                                <label class="form-check-label" for="exampleCheck"
                                                    id="exampleCheckLabel">Política de
                                                    privacidad</label>
                                                <button type="button"
                                                    class="btn btn-link link-dark p-1 lh-1 rounded-circle position-relative"
                                                    data-popover="Lorem ipsum dolor sit amet consectetur adipisicing elit. Iste dolore quaerat id aliquam, est architecto culpa illum explicabo sapiente reiciendis impedit molestiae libero adipisci autem vitae? Cupiditate vel dicta expedita?"
                                                    title="Más información">
                                                    <i class="bi bi-info-circle-fill fs-5" role="img"
                                                        aria-label="Más información sobre Política de privacidad"></i>
                                                </button>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn btn-primary">Enviar</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>

                    <h2 class="border-bottom pb-3"><i class="bi bi-code-square"></i> Código generado</h2>
                    <div class="vstack gap-3">
                        <div class="card h-100 overflow-hidden">
                            <div class="card-header">
                                <h3 class="card-title h5 mb-0">HTML</h3>
                            </div>
                            <pre class="card-body text-bg-dark mh-15 mb-0">
&lt;!-- Tooltip --&gt;

&lt;button type="button"
    class="btn btn-light lh-1 p-3 my-n2 me-n3 rounded-top-2 rounded-start-0 rounded-bottom-0 border-0 position-relative"
    title="Notificaciones"&gt;&lt;i class="bi bi-bell-fill fs-4" role="img"
        aria-label="Notificaciones"&gt;&lt;/i&gt;
    &lt;span
        class="position-absolute top-0 end-0 m-1 badge rounded-pill bg-danger"&gt;
        3 &lt;span class="visually-hidden"&gt;sin leer&lt;/span&gt;
    &lt;/span&gt;
&lt;/button&gt;

&lt;!-- Popover --&gt;

&lt;button type="button"
    class="btn btn-link link-dark p-1 lh-1 rounded-circle position-relative"
    aria-pressed="false"
    data-popover="Lorem ipsum dolor sit amet consectetur adipisicing elit. Iste dolore quaerat id aliquam, est architecto culpa illum explicabo sapiente reiciendis impedit molestiae libero adipisci autem vitae? Cupiditate vel dicta expedita?"&gt;
    &lt;i&gt; class="bi bi-info-circle-fill fs-5" role="img"
        aria-label="Más información sobre Política de privacidad"&gt;&lt;/i&gt;
&lt;/button&gt;</pre>
                        </div>
                        <div class="card h-100 overflow-hidden">
                            <div class="card-header">
                                <h3 class="card-title h5 mb-0">CSS</h3>
                            </div>
                            <pre class="card-body text-bg-dark mh-15 mb-0">
.popup-container {
    display: inline-block;
    position: relative;
}

/* Tooltip */

.popup-container [role="tooltip"] {
    display: none;
    position: absolute;
    left: 50%;
    bottom: 100%;
    transform: translateX(-50%);
    font-size: 0.9rem;
    width: max-content;
    max-width: 12.5em;
    z-index: 5;
}

.popup-container [role="tooltip"] span {
    display: block;
    padding: 0.25rem 0.5rem;
    background: #0f0f0f;
    color: #f0f0f0;
    border-radius: 0.25rem;
    box-shadow: 0 0 3px 0 #00000066;
}

.popup-container [role="tooltip"]::before,
.popup-container [role="tooltip"]::after {
    content: '';
    display: block;
    width: 0;
    height: 0;
    position: absolute;
    left: 50%;
    top: 100%;
    border: 0.25rem solid #0f0f0f;
    transform: translate(-50%, -50%) rotate(45deg);
}

.popup-container [role="tooltip"]::after {
    box-shadow: 0 0 3px 0 #00000066;
    z-index: -1;
}


.popup-container.hover:hover>[role="tooltip"],
.popup-container>.focused:focus+[role="tooltip"] {
    display: inline-block;
}

/* Popover */

.popup-container [role="status"] {
    display: none;
    position: absolute;
    left: 100%;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.9rem;
    width: max-content;
    max-width: 25em;
    margin-left: 0.2rem;
    z-index: 6;
}

.popup-container [role="status"] span {
    display: block;
    padding: 0.75rem 1rem;
    background: #fff;
    color: #000;
    border-radius: 0.25rem;
    box-shadow: 0 0 3px 0 #00000066;
}

.popup-container [role="status"]::before,
.popup-container [role="status"]::after {
    content: '';
    display: block;
    width: 0;
    height: 0;
    position: absolute;
    right: 100%;
    top: 50%;
    border: 0.25rem solid #fff;
    transform: translate(50%, -50%) rotate(45deg);
}

.popup-container [role="status"]::after {
    box-shadow: 0 0 3px 0 #00000066;
    z-index: -1;
}

.popup-container.open>[role="status"] {
    display: inline-block;
}</pre>
                        </div>
                        <div class="card h-100 overflow-hidden">
                            <div class="card-header">
                                <h3 class="card-title h5 mb-0">JS</h3>
                            </div>
                            <pre class="card-body text-bg-dark mh-15 mb-0">
class Popup {
    constructor(domNode) {
        var container;

        container = document.createElement('span');
        container.classList.add('popup-container');
        domNode.after(container);
        container.append(domNode);

        // Get the message from the title or data-popover element
        if (domNode.hasAttribute('title')) {
            container.innerHTML += '&lt;span role="tooltip" aria-hidden="true"&gt;&lt;span&gt;' + domNode.getAttribute('title') + '&lt;/span&gt;&lt;/span&gt;';
            domNode = container.querySelector('[title]');
        }

        if (domNode.hasAttribute('data-popover')) {
            container.innerHTML += '&lt;span&gt; role="status"&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;';
            domNode = container.querySelector('[data-popover]');
            domNode.setAttribute('aria-pressed', false);
        }
    }
}

class Tooltip {
    constructor(domNode) {
        this.tooltipNode = domNode;
        this.tooltipNode.parentNode.addEventListener('mouseover', () => this.onMouseover(event));
        this.tooltipNode.parentNode.addEventListener('mouseleave', () => this.onMouseleave(event));
        this.tooltipNode.addEventListener('focus', () => this.onFocus(event));
        this.tooltipNode.addEventListener('blur', () => this.onBlur(event));
        document.addEventListener('keydown', () => this.onKeydown(event));
        domNode.removeAttribute('title');
    }

    // Toggle the message
    onMouseover(event) {
        event.currentTarget.classList.add('hover');
    }

    onMouseleave(event) {
        event.currentTarget.classList.remove('hover');
    }

    // Close on outside
    onFocus(event) {
        event.currentTarget.classList.add('focused');
    }

    onBlur(event) {
        event.currentTarget.classList.remove('focused');
    }

    // Remove tooltip on ESC
    onKeydown(event) {
        if ((event.keyCode || event.which) === 27) {
            Array.from(document.querySelectorAll('.popup-container')).forEach((el) => {
                el.classList.remove('hover');
                el.firstChild.classList.remove('focused');
            });
        }
    }
}

class Popover {
    constructor(domNode) {
        this.popoverNode = domNode;
        this.popoverNode.addEventListener('click', () => this.onClick(event));
        document.addEventListener('click', () => this.onClickOut(event));
        document.addEventListener('keydown', () => this.onKeydown(event));
    }

    // Toggle the message
    onClick(event) {
        if (event.currentTarget.parentNode.classList.contains('open')) {
            event.currentTarget.parentNode.classList.remove('open');
            event.currentTarget.parentNode.querySelector('[role="status"]').querySelector('span').innerText = '';
        } else {
            event.currentTarget.parentNode.classList.add('open');
            var el = event.currentTarget.parentNode.querySelector('[role="status"]').querySelector('span');
            var text = event.currentTarget.dataset.popover;
            setTimeout(() => {
                el.innerText = text;
            }, 1);
        }
    }

    // Close on outside click
    onClickOut(event) {
        Array.from(document.querySelectorAll('[data-popover]')).forEach((el) => {
            if (!el.parentNode.contains(event.target)) {
                el.parentNode.classList.remove('open');
                el.parentNode.querySelector('[role="status"]').querySelector('span').innerText = '';
                el.setAttribute('aria-pressed', false);
            }
        });
    }

    // Remove popover on ESC
    onKeydown(event) {
        if ((event.keyCode || event.which) === 27) {
            Array.from(document.querySelectorAll('[data-popover]')).forEach((el) => {
                el.parentNode.classList.remove('open');
                el.parentNode.querySelector('[role="status"]').querySelector('span').innerText = '';
                el.setAttribute('aria-pressed', false);
            });
        }
    }
}

class Pressed {
    constructor(domNode) {
        this.switchNode = domNode;
        this.switchNode.addEventListener('click', () => this.onClick(event));
    }

    onClick(event) {
        if (event.currentTarget.getAttribute('aria-pressed') === 'true') {
            event.currentTarget.setAttribute('aria-pressed', false);
        } else {
            event.currentTarget.setAttribute('aria-pressed', true);
        }
    }
}

(function () {
    window.setTimeout(() => {
        // Iterate over them
        Array.from(document.querySelectorAll('[title], [data-popover]')).forEach((el) => new Popup(el));
        Array.from(document.querySelectorAll('[title]')).forEach((el) => new Tooltip(el));
        Array.from(document.querySelectorAll('[data-popover]')).forEach((el) => new Popover(el));
        Array.from(document.querySelectorAll('[aria-pressed]')).forEach((el) => new Pressed(el));
    }, 100);
}());</pre>
                        </div>
                    </div>
                </div>
                <div class="col col-xl-3"></div>
            </div>
        </div>
    </main>
    <div id="footer" class="mt-auto"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
        integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="../custom.js"></script>
</body>

</html>